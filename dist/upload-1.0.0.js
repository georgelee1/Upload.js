/** Upload.js (1.0.0) | https://github.com/georgelee1/Upload.js | MIT (https://github.com/georgelee1/Upload.js/blob/master/LICENSE) */!function e(t,n,i){function r(s,o){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return r(n?n:e)},f,f.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return new h.Matcher(e)}function u(e){return new h.DOMList(e)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.Widget=void 0;var f=e("../util/options"),c=e("../util/queue"),h=e("../util/dom"),d=(n.Widget=function(){function e(t,n){s(this,e),this._ele=u(t),this._opts=new f.Options(n,t),this._size=0,this._max=this._opts.get("max"),this._queue=new c.Queue(this._next,{delay:this._opts.get("delay")}),this._parser=new h.SimpleDOMParser,this._listeners={},this._init()}return l(e,[{key:"_init",value:function(){var e=this;this._ele.addClass("uploadjs"),this._picker=u("input").attr({type:"file",multiple:"multiple"}).appendTo(this._ele).on("change",this._picked.bind(this)),this._ele.find("img").each(function(t){var n=u(t),i=n.data("uploadImageId");if("undefined"!=typeof i&&(!e._max||e._size<e._max)){var r=e._parser.parse(e._opts.get("template.item"));r.find("img").attr("src",n.attr("src")),e._opts.get("deletable")!==!1?e._parser.parse(e._opts.get("template.actions")).appendTo(r):r.addClass("static"),r.appendTo(e._ele),e._size++}n.remove()}),this._add=this._parser.parse(this._opts.get("template.add")).appendTo(this._ele),this._picker=this._picker.items[0],this._ele.on("click",o(!0).css("item","new"),this._picker.click.bind(this._picker)),this._ele.on("click",o(!0).css("del"),this._delete.bind(this));var t=function(){e._size--,e._update()};this._addListener("upload.failed",t),this._addListener("delete.done",t),this._allowedTypes=[];var n=this._opts.get("allowed_types"),i=this._opts.get("types");Array.isArray(n)&&n.forEach(function(t){Array.isArray(i[t])?i[t].forEach(function(t){e._allowedTypes.push(t.toLowerCase())}):e._allowedTypes.push(t.toLowerCase())}),this._update()}},{key:"_addListener",value:function(e,t){if("function"==typeof t){var n=this._listeners[e];n||(n=this._listeners[e]=[]),n.push(t)}}},{key:"_picked",value:function(){for(var e=this,t=this._picker.files,n=0;n<t.length;n++)(!this._max||this._size<this._max)&&this._typeAllowed(t[n])&&!function(){var i=e._parser.parse(e._opts.get("template.item")).addClass("uploading");e._parser.parse(e._opts.get("template.uploading")).appendTo(i);var r=new FileReader;r.onload=function(e){i.find("img").attr("src",e.target.result)},r.readAsDataURL(t[n]),i.before(e._add),e._size++,e._update(),e._queue.offer(new _(i,t[n],e,e._listeners))}();this._picker.value=""}},{key:"_typeAllowed",value:function(e){return this._allowedTypes.indexOf(e.type)>=0}},{key:"_delete",value:function(e){var t=u(e.target).parent(o().css("item")).addClass("removing");this._parser.parse(this._opts.get("template.deleting")).appendTo(t),this._queue.offer(new v(t,this,this._listeners))}},{key:"_next",value:function(e,t){e.run(t)}},{key:"_update",value:function(){this._max&&(this._size<this._max?this._add.removeClass("hide"):this._add.addClass("hide"))}}]),e}(),function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?16:arguments[1];s(this,e),this._handler=t,this._delay=n}return l(e,[{key:"_fire",value:function(){"undefined"==typeof this._val?(clearInterval(this._interval),this._interval=!1):(this._handler.call(this,this._val),delete this._val)}},{key:"value",set:function(e){this._val=e,this._interval||"undefined"==typeof this._val||(this._interval=setInterval(this._fire.bind(this),this._delay))}}]),e}()),p=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];s(this,e),this._listeners=t}return l(e,[{key:"_trigger",value:function(e){this._listeners&&Array.isArray(this._listeners[e.type])&&this._listeners[e.type].forEach(function(t){"function"==typeof t&&t.call(null,e)})}}]),e}(),_=function(e){function t(e,n,i,a){s(this,t);var o=r(this,Object.getPrototypeOf(t).call(this,a));return o._ele=e,o._file=n,o._widget=i,o._fin=!1,o._up=new d(o._update.bind(o),200),o._trigger({type:"upload.added",file:o._file}),o}return a(t,e),l(t,[{key:"run",value:function(e){this._trigger({type:"upload.started",file:this._file}),this._dom_progress=this._ele.find(".progress");var t=this;this._widget._opts.get("upload.url",function(n){t._widget._opts.get("http")(n,i({},t._widget._opts.get("upload.param"),t._file)).progress(t._progress.bind(t)).done(t._done.bind(t,e)).fail(t._fail.bind(t,e))})}},{key:"_progress",value:function(e){this._fin||(this._up.value=e,this._trigger({type:"upload.progress",file:this._file,progress:e}))}},{key:"_update",value:function(e){this._fin||this._dom_progress.css("transform","translateX(-"+(100-e)+"%)")}},{key:"_done",value:function(e,t){if(!t.success)return void this._fail(e);this._update(0),this._fin=!0,this._ele.removeClass("uploading");var n=this._widget._parser.parse(this._widget._opts.get("template.done")).appendTo(this._ele),i=t["upload-image-id"]||t.uploadImageId;"undefined"!=typeof i&&(this._ele.data("uploadImageId",i),this._widget._opts.get("deletable")!==!1?this._widget._parser.parse(this._widget._opts.get("template.actions")).appendTo(this._ele):this._ele.addClass("static")),setTimeout(function(){n.addClass("going"),setTimeout(function(){n.remove()},3e3)},2e3),this._trigger({type:"upload.done",file:this._file,id:i}),e()}},{key:"_fail",value:function(e){var t=this;this._update(0),this._fin=!0,this._ele.addClass("stopped"),this._widget._parser.parse(this._widget._opts.get("template.error")).appendTo(this._ele),setTimeout(function(){t._ele.addClass("removed"),setTimeout(function(){t._ele.remove()},1e3)},1e4),this._trigger({type:"upload.failed",file:this._file}),e()}}]),t}(p),v=function(e){function t(e,n,i){s(this,t);var a=r(this,Object.getPrototypeOf(t).call(this,i));return a._ele=e,a._widget=n,a._id=a._ele.data("uploadImageId"),a._trigger({type:"delete.added",id:a._id}),a}return a(t,e),l(t,[{key:"run",value:function(e){this._trigger({type:"delete.started",id:this._id});var t=this;this._widget._opts.get("delete.url",function(n){t._widget._opts.get("http")(n,i({},t._widget._opts.get("delete.param"),t._id)).done(t._done.bind(t,e)).fail(t._fail.bind(t,e))})}},{key:"_done",value:function(e,t){var n=this;return t.success?(this._ele.removeClass("removing").addClass("removed"),setTimeout(function(){n._ele.remove()},1e3),this._trigger({type:"delete.done",id:this._id}),void e()):void this._fail(e)}},{key:"_fail",value:function(e){this._ele.removeClass("removing");var t=this._widget._parser.parse(this._widget._opts.get("template.error")).appendTo(this._ele);setTimeout(function(){t.addClass("going"),setTimeout(function(){t.remove()},3e3)},2e3),this._trigger({type:"delete.failed",id:this._id}),e()}}]),t}(p)},{"../util/dom":4,"../util/options":6,"../util/queue":7}],2:[function(e,t,n){"use strict";function i(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){Object.keys(t).forEach(function(n){n in e&&"object"===i(e[n])&&"object"===i(t[n])?e[n]=a(e[n],t[n]):e[n]=t[n]})}function s(e){if(Array.isArray(e)){var t=function(){var t=[];return e.forEach(function(e){t.push(s(e))}),{v:t}}();if("object"===("undefined"==typeof t?"undefined":i(t)))return t.v}else{if("object"!==("undefined"==typeof e?"undefined":i(e)))return e;var n=function(){var t={};return Object.keys(e).forEach(function(n){t[n]=s(e[n])}),{v:t}}();if("object"===("undefined"==typeof n?"undefined":i(n)))return n.v}}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./ui/widget"),l=e("./util/http"),f={template:{item:"div.item (img)",add:"div.item.new (div.icon.plus)",actions:"div.actions (div.action.del (div.trash))",deleting:"div.spinner div.icon.trash",uploading:"div.spinner div.icon.upload div.progress",done:"div.icon.done (i)",error:"div.icon.error (i)"},max:0,deletable:!0,types:{images:["image/jpg","image/jpeg","image/png","image/gif"]},allowed_types:["images"],upload:{url:function(){return this.dataset.uploadUrl},param:function(){return this.dataset.uploadParam||"file"}},"delete":{url:function(){return this.dataset.deleteUrl},param:function(){return this.dataset.deleteParam||"file"}},http:function(){return url,function(e){return new l.Http(url,e)}}};window.UploadJs=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,e);var i=s(f);a(i,s(n)),this._widget=new u.Widget(t,i)}return o(e,[{key:"on",value:function(e,t){var n=this;e.split(" ").forEach(function(e){n._widget._addListener(e,t)})}}]),e}()},{"./ui/widget":1,"./util/http":5}],3:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});n.Cache=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0];i(this,e),this._max=t,this._map={},this._head={},this._tail={prev:this._head},this._head.next=this._tail,this.length=0}return r(e,[{key:"get",value:function(e){var t=this._map[e];return this._insertAtTail(t),t?t.val:void 0}},{key:"put",value:function(e,t){this._max>0&&this.length>0&&this.length==this._max&&this.remove(this._head.next.key);var n=this._map[e],i=!0;return n?(n.val=t,i=!1):(n={key:e,val:t},this._map[e]=n,this.length++),this._insertAtTail(n),i}},{key:"remove",value:function(e){var t=this._map[e];return t?(delete this._map[e],this._evict(t),this.length--,t.val):void 0}},{key:"_evict",value:function(e){if(e){var t=e.prev,n=e.next;t.next=n,n.prev=t}}},{key:"_insertAtTail",value:function(e){e&&(e.next&&this._evict(e),e.prev=this._tail.prev,e.prev.next=e,e.next=this._tail,this._tail.prev=e)}}]),e}()},{}],4:[function(e,t,n){"use strict";function i(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){var t=[];return Array.isArray(e)?t=e:Array.isArray(e.items)?t=e.items:t.push(e),t}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.Matcher=n.DOMList=n.SimpleDOMParser=void 0;var o=e("./cache"),u=(n.SimpleDOMParser=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?10:arguments[0];r(this,e),this._cache=new o.Cache(t)}return s(e,[{key:"parse",value:function(e){var t=this._cache.get(e);return t||(t=new u(this._build(e)),this._cache.put(e,t)),t.clone()}},{key:"_build",value:function(e){var t=[],n=!1,i=[];if(e.split(/(\s*[ \s\(\)]\s*)/).forEach(function(e){var r=e.trim();if(0!==r.length)if(")"===r){var a=i.pop();if(!a)throw"ExpressiveDOMParser: Invalid location for closing parenthesis";n=a.node,t.forEach(function(e){return n.appendChild(e)}),t=a.nodes}else if("("===r){if(!n)throw"ExpressiveDOMParser: Invalid location for opening parenthesis";i.push({node:n,nodes:t}),t=[]}else{var s=r.split("."),o=s.shift();n=document.createElement(o),s.length&&(n.className=s.join(" ")),t.push(n)}}),i.length)throw"ExpressiveDOMParser: Unmatched opening and closing parenthesis";return t}}]),e}(),n.DOMList=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];r(this,e),"string"==typeof t?this.items=[document.createElement(t)]:Array.isArray(t)?this.items=t:(this.items=[],t&&this.items.push(t))}return s(e,[{key:"clone",value:function(){var t=[];return this.items.forEach(function(e){t.push(e.cloneNode(!0))}),new e(t)}},{key:"appendTo",value:function(e){var t=this;return a(e).forEach(function(e){t.items.forEach(function(t){e.appendChild(t)})}),this}},{key:"before",value:function(e){var t=this;return a(e).forEach(function(e){t.items.forEach(function(t){e.parentNode.insertBefore(t,e)})}),this}},{key:"remove",value:function(){return this.items.forEach(function(e){e.parentNode.removeChild(e)}),this}},{key:"parent",value:function(t){var n=void 0;return t instanceof f?this.items.some(function(e){for(var i=e.parentNode;i;){if(t.test(i))return n=i,!0;i=i.parentNode}}):this.items.some(function(e){return e.parentNode?(n=e.parentNode,!0):void 0}),new e(n)}},{key:"addClass",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return this.items.forEach(function(e){var n=e.className?e.className.split(" "):[];t.forEach(function(e){n.indexOf(e)<0&&n.push(e)}),e.className=n.join(" ")}),this}},{key:"removeClass",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return this.items.forEach(function(e){var n=e.className?e.className.split(" "):[];t.forEach(function(e){var t=n.indexOf(e);t>=0&&n.splice(t,1)}),e.className=n.join(" ")}),this}},{key:"css",value:function(e,t){return this.items.forEach(function(n){"object"===("undefined"==typeof e?"undefined":i(e))?Object.keys(e).forEach(function(t){n.style[t]=e[t]}):n.style[e]=t}),this}},{key:"attr",value:function(e,t){if("object"===("undefined"==typeof e?"undefined":i(e)))this.items.forEach(function(t){Object.keys(e).forEach(function(n){"undefined"==typeof e[n]?t.removeAttribute(n):t.setAttribute(n,e[n])})});else{if("undefined"==typeof t){var n=void 0;return this.items.some(function(t){var i=t.getAttribute(e);return"undefined"!=typeof i?(n=i,!0):void 0}),n}this.items.forEach(function(n){return n.setAttribute(e,t)})}return this}},{key:"data",value:function(e,t){if("object"===("undefined"==typeof e?"undefined":i(e)))this.items.forEach(function(t){Object.keys(e).forEach(function(n){"undefined"==typeof e[n]?delete t.dataset[n]:t.dataset[n]=e[n]})});else{if("undefined"==typeof t){var n=void 0;return this.items.some(function(t){var i=t.dataset[e];return"undefined"!=typeof i?(n=i,!0):void 0}),n}this.items.forEach(function(n){return n.dataset[e]=t})}return this}},{key:"on",value:function(e,t,n){return this.items.forEach(function(i){i.addEventListener(e,function(e){t instanceof f?t.test(e.target)&&n(e):t(e)})}),this}},{key:"find",value:function(t){var n=[];return this.items.forEach(function(e){for(var i=e.querySelectorAll(t),r=0,a=i.length;a>r;r++)n.push(i[r])}),new e(n)}},{key:"each",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;t>i;i++)n[i]=arguments[i];return n.forEach(function(t){e.items.forEach(function(e){t(e)})}),this}}]),e}()),l={type:function(e,t){return t.tagName.toUpperCase()===e.toUpperCase()},css:function(e,t){var n=(t.className||"").split(" ");return e.every(function(e){return n.indexOf(e)>=0})}},f=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];r(this,e),this._bubble=t,this._matchers=[]}return s(e,[{key:"type",value:function(e){return this._matchers.push(l.type.bind(this,e)),this}},{key:"css",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return this._matchers.push(l.css.bind(this,t)),this}},{key:"test",value:function(e){var t=this;return a(e).every(function(e){for(var n=e,i=!1;n&&n.parentNode!==n;){if(i=t._matchers.every(function(e){return e(n)}))return!0;if(!t._bubble)return!1;n=n.parentNode}return!1},this)}}]),e}();n.Matcher=f},{"./cache":3}],5:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=function(){},s=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this._url=t,this._params=n,this._progress=a,this._done=a,this._fail=a,this._post()}return r(e,[{key:"progress",value:function(e){return"function"==typeof e&&(this._progress=e),this}},{key:"done",value:function(e){return"function"==typeof e&&(this._done=e),this}},{key:"fail",value:function(e){return"function"==typeof e&&(this._fail=e),this}},{key:"_post",value:function(){var e=this,t="application/x-www-form-urlencoded",n=new FormData,i=function(i){var r=e._params[i];Array.isArray(r)?r.forEach(function(e){e.type&&e.name?(t="multipart/form-data",n.append(i,e,e.name)):n.append(i,e)}):r.type&&r.name?(t="multipart/form-data",n.append(i,r,r.name)):n.append(i,r)};for(var r in this._params)i(r);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(a.status>=200&&a.status<300)try{e._done(JSON.parse(a.response))}catch(t){e._fail()}else e._fail()},a.upload.addEventListener("progress",function(t){e._progress(Math.ceil(t.loaded/t.total*100))},!1),a.open("POST",this._url,!0),a.setRequestHeader("Content-Type",t),a.send(n)}}]),e}();n.Http=s},{}],6:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});n.Options=function(){function e(t,n){i(this,e),this._opts=t,this._context=n||this}return r(e,[{key:"get",value:function(e,t){var n=this._opts;if(e.split(".").forEach(function(e){n=n[e]}),"function"!=typeof n&&(n=function(e){return function(){return e}}(n)),n.length>0){var i=void 0;return n.apply(this._context,[t||function(e){i=e}]),i}return t?void t.apply(this._context,[n.apply(this._context)]):n.apply(this._context)}}]),e}()},{}],7:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});n.Queue=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this._handler=t,this._concurrency=Math.max(n.concurrency,1)||1,this._delay=Math.max(n.delay,0)||0,this._size=Math.max(n.size,0)||0,this._queue=[],this._working=[],this._id=0}return r(e,[{key:"offer",value:function(e){return!this._size||this._queue.length<this._size?(this._queue.push({item:e}),this._next(),!0):!1}},{key:"_next",value:function(){var e=this;this._working.length<this._concurrency&&!function(){var t=e._queue.shift();void 0!==t&&!function(){var n=++e._id,i=function(){var t=e._working.indexOf(n);t>=0&&(e._working.splice(t,1),e._next())},r=function(){e._handler.apply(e,[t.item,i])};e._working.push(n),e._delay?setTimeout(r,e._delay):r()}()}()}}]),e}()},{}]},{},[2]);